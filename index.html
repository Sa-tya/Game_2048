<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAME 2048</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <section id="section">

    </section>
    <script>
        function getRandomInt(max) {
            return Math.floor(Math.random() * max);
            }
        var grid = [
            [0, 0, 0, 0],
            [0, 0, 0, 0],
            [0, 0, 0, 0],
            [0, 0, 0, 0]
        ];
        var vacant = 0;
        // DOM manipulation

        const section = document.getElementById('section')
        for(let i=0;i<16;++i){
            let element = document.createElement('span');
            // element.innerHTML = grid[Math.floor(i/4)][Math.floor(i%4)]
            element.className = 'box';
            section.appendChild(element)
        }

        const child = section.children

        function display(){
            vacant=0;
            for(let i=0;i<16;i++){
                child[i].innerHTML = grid[Math.floor(i/4)][Math.floor(i%4)] ? grid[Math.floor(i/4)][Math.floor(i%4)] : ''
                if(! grid[Math.floor(i/4)][Math.floor(i%4)])
                vacant++;
            }
            if(!vacant){
                    setTimeout(()=> {
                        alert("try again...")
                    location.reload()
                    },1000)
                }
        }
        function random_generate(x){

            while(grid[Math.floor(x/4)][Math.floor(x%4)])
                x = getRandomInt(16)
            grid[Math.floor(x/4)][Math.floor(x%4)] = (getRandomInt(2) ? 4 : 2);
            display();
        }

        function upArrow(){
            // UP shift of boxes
            let x=0,y=0;
            for(let j=0;j<4;++j){
                x=0;
                for(let i=0;i<4;++i){
                    if(grid[i][j]){
                       grid[x++][y] = grid[i][j]
                    }
                    if(i >(x-1)) grid[i][j] = 0
                }
                ++y;
            }
            // Mixing...
            y=0;
            for(let j=0;j<4;++j){
                x=0;
                for(let i=1;i<4;++i){

                    if(grid[i][j] === grid[i-1][j]){
                        grid[x++][y] = grid[i][j] + grid[i-1][j]
                        grid[i][j] = 0
                    // i++;
                }
                    else if(grid[i][j]){
                        x += 1;
                    } else break;
                }
                y++;
            }

            random_generate(getRandomInt(16));
        }

        function downArrow(){
            let x=0,y=0;
            for(let j=0;j<4;++j){
                x=3;
                for(let i=3;i>=0;--i){
                    if(grid[i][j]){
                       grid[x--][y] = grid[i][j]
                    }
                    if(i <(x+1)) grid[i][j] = 0
                }
                ++y;
            }
            // Mixing...
            y=0;
            for(let j=0;j<4;++j){
                x=3;
                for(let i=2;i>=0;--i){

                    if(grid[i][j] === grid[i+1][j]){
                        grid[x--][y] = grid[i][j] + grid[i+1][j]
                        grid[i][j] = 0
                    // i++;
                }
                    else if(grid[i][j]){
                        x -= 1;
                    } else break;


                }
                y++;
            }
            random_generate(getRandomInt(16));
        }

        function leftArrow(){
            let x=0,y=0;
            for(let i=0;i<4;++i){
                y=0;
                for(let j=0;j<4;++j){
                    if(grid[i][j]){
                       grid[x][y++] = grid[i][j];
                    }
                    if(j > (y-1)){
                        grid[i][j]=0;
                    }
                }
                ++x;
            }
            // Adding...
            x=0;
            for(let i=0;i<4;++i){
                y=0;
                for(let j=1;j<4;++j){
                    if(grid[i][j] === grid[i][j-1]){
                        grid[x][y++] = grid[i][j] + grid[i][j-1];
                        grid[i][j] = 0;

                    }
                    else if(grid[i][j]) y++;
                    else break;
                }
                x++;
            }
            random_generate(getRandomInt(16));
        }

        function rightArrow(){
            let x=0,y=0;
            for(let i=0;i<4;++i){
                y=3;
                for(let j=3;j>=0;--j){
                    if(grid[i][j]){
                       grid[x][y--] = grid[i][j];
                    }
                    if(j < (y+1)){
                        grid[i][j]=0;
                    }
                }
                ++x;
            }
            // Addition
            x=0
            for(let i=0;i<4;++i){
                y=3;
                for(let j=3;j>0;--j){ 
                    if(grid[i][j] === grid[i][j-1]){
                        grid[x][y--] = grid[i][j] + grid[i][j-1]
                        grid[i][j-1] = 0
                    }
                    else if(grid[i][j-1]) y--;
                    else break;
                }
                x++;
            }
            random_generate(getRandomInt(16));
        }
        document.onkeydown = checkKey;
            function checkKey(e) {
                // e = e || window.event;
                if (e.keyCode == '38') {
                    upArrow()
                }
                else if (e.keyCode == '40') {
                    downArrow()
                }
                else if (e.keyCode == '37') {
                    leftArrow()
                }
                else if (e.keyCode == '39') {
                    rightArrow()
                }
            }
            random_generate(getRandomInt(16))
            random_generate(getRandomInt(16))
    </script>
</body>
</html>